<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Seay Wellness - Complete M4 Assessment System</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; line-height: 1.6; padding: 20px; color: #333; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .container { max-width: 1800px; margin: 0 auto; background: white; padding: 30px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); }
        h1 { color: #667eea; text-align: center; font-size: 2.5em; margin-bottom: 10px; text-shadow: 2px 2px 4px rgba(0,0,0,0.1); }
        .subtitle { text-align: center; color: #666; font-size: 1.1em; margin-bottom: 30px; font-weight: 500; }
        h2 { color: #764ba2; border-bottom: 3px solid #667eea; padding-bottom: 10px; margin-top: 30px; margin-bottom: 20px; }
        h3 { color: #667eea; margin-top: 20px; margin-bottom: 10px; }
        h4 { color: #764ba2; margin-top: 15px; margin-bottom: 8px; }
        .section { margin-bottom: 30px; padding: 20px; border: 2px solid #e0e0e0; border-radius: 10px; background-color: #f9f9f9; }
        .input-group { margin-bottom: 15px; }
        .input-group label { display: block; font-weight: bold; margin-bottom: 5px; color: #555; }
        .input-group input, .input-group textarea, .input-group select { width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 5px; font-size: 14px; }
        .input-group input:focus, .input-group textarea:focus, .input-group select:focus { outline: none; border-color: #667eea; }
        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .grid-3 { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; }
        .grid-4 { display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; }
        button { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 15px 30px; border: none; border-radius: 8px; cursor: pointer; font-size: 16px; font-weight: bold; transition: all 0.3s; display: block; margin: 20px auto; }
        button:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4); }
        .checkbox-group { display: flex; flex-wrap: wrap; gap: 15px; margin-top: 10px; }
        .checkbox-item { display: flex; align-items: center; padding: 8px 12px; background-color: #f0f0f0; border-radius: 5px; cursor: pointer; transition: all 0.3s; }
        .checkbox-item:hover { background-color: #e0e0e0; }
        .checkbox-item input[type="checkbox"] { width: auto; margin-right: 8px; }
        .fit-test-card { background: white; padding: 15px; border-radius: 8px; border-left: 4px solid #667eea; margin-bottom: 15px; }
        .fit-test-card h4 { color: #764ba2; margin-bottom: 10px; }
        .consequences-box { background: #fff3e0; border-left: 4px solid #ff9800; padding: 15px; margin: 15px 0; border-radius: 5px; }
        .consequences-box h5 { color: #e65100; margin-bottom: 10px; font-size: 16px; }
        .deviation-btn { display: block; width: 100%; margin-bottom: 8px; padding: 12px; background-color: #f8f9fa; border: 2px solid #ddd; border-radius: 5px; cursor: pointer; text-align: left; font-size: 14px; color: #333; transition: all 0.3s; font-weight: 500; }
        .deviation-btn:hover { background-color: #e9ecef; border-color: #adb5bd; transform: translateX(5px); }
        .deviation-btn.selected { background: linear-gradient(135deg, #4caf50 0%, #45a049 100%); color: white; border-color: #388e3c; font-weight: bold; }
        .spine-container { display: flex; justify-content: center; gap: 50px; margin: 30px 0; flex-wrap: wrap; }
        .spine-grid { display: flex; flex-direction: column; align-items: center; }
        .spine-section-label { font-weight: bold; color: #667eea; margin: 15px 0 5px 0; font-size: 14px; }
        .vertebra { width: 70px; height: 35px; margin: 3px; border: 2px solid #ccc; display: flex; align-items: center; justify-content: center; cursor: pointer; background: linear-gradient(135deg, #ffffff 0%, #f0f0f0 100%); transition: all 0.3s; font-weight: bold; border-radius: 5px; }
        .vertebra:hover { background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%); transform: scale(1.05); box-shadow: 0 2px 8px rgba(0,0,0,0.2); }
        .vertebra.selected { background: linear-gradient(135deg, #ef5350 0%, #c62828 100%); color: white; border-color: #b71c1c; animation: pulse 0.5s; }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.1); } 100% { transform: scale(1); } }
        #subluxation-info { margin-top: 20px; padding: 20px; background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%); border-radius: 8px; border-left: 5px solid #4caf50; display: none; }
        #subluxation-info h4 { margin-top: 0; color: #2e7d32; }
        .supplement-card { background: #e8f5e9; padding: 15px; margin: 10px 0; border-radius: 8px; border-left: 4px solid #4caf50; }
        .lab-card { background: #fce4ec; padding: 15px; margin: 10px 0; border-radius: 8px; border-left: 4px solid #e91e63; }
        .service-selector { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; margin: 15px 0; }
        .service-item { background: white; padding: 15px; border-radius: 8px; border: 2px solid #e0e0e0; transition: all 0.3s; }
        .service-item:hover { border-color: #667eea; box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3); }
        .service-item input[type="checkbox"] { width: auto; margin-right: 8px; }
        .coverage-option { display: flex; align-items: center; gap: 10px; margin-top: 10px; }
        .coverage-option input[type="checkbox"] { width: auto; }
        .cost-summary { background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%); padding: 20px; border-radius: 10px; margin: 20px 0; border: 2px solid #667eea; }
        .cost-summary h3 { color: #1976d2; margin-top: 0; }
        .cost-row { display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid #90caf9; }
        .cost-total { font-size: 1.3em; font-weight: bold; color: #1565c0; padding-top: 15px; }
        .plan-selector { background: #e3f2fd; border: 2px solid #667eea; padding: 20px; border-radius: 10px; margin: 20px 0; }
        .plan-option { background: white; padding: 15px; margin: 10px 0; border-radius: 8px; border: 2px solid #e0e0e0; cursor: pointer; transition: all 0.3s; }
        .plan-option:hover { border-color: #667eea; transform: translateX(5px); }
        .plan-option.selected { border-color: #667eea; background: #f3f4ff; }
        .report-output { margin-top: 30px; padding: 30px; background: white; border-radius: 10px; border: 3px solid #667eea; display: none; }
        .severity-badge { display: inline-block; padding: 8px 16px; border-radius: 20px; font-weight: bold; font-size: 16px; }
        .severity-mild { background-color: #4caf50; color: white; }
        .severity-moderate { background-color: #ff9800; color: white; }
        .severity-severe { background-color: #f44336; color: white; }
        .action-buttons { display: flex; gap: 15px; justify-content: center; margin: 20px 0; flex-wrap: wrap; }
        .print-button { background: linear-gradient(135deg, #4caf50 0%, #45a049 100%); }
        .print-button:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(76, 175, 80, 0.4); }
        .pdf-button { background: linear-gradient(135deg, #f44336 0%, #d32f2f 100%); }
        .pdf-button:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(244, 67, 54, 0.4); }
        @media print { body { background: white; } .container { box-shadow: none; } button { display: none !important; } .section { page-break-inside: avoid; } .action-buttons { display: none !important; } #logo-display img { max-width: 400px !important; max-height: 120px !important; } }
    </style>
</head>
<body>
    <div class="container">
        <div style="text-align: center; margin-bottom: 30px;">
            <div id="logo-display" style="margin-bottom: 15px; min-height: 80px; display: flex; align-items: center; justify-content: center;"></div>
            <div style="padding: 15px; background: #f8f9fa; border-radius: 8px;">
                <input type="file" id="logo-upload" accept="image/*" style="display: none;">
                <button type="button" onclick="document.getElementById('logo-upload').click()" style="padding: 8px 20px; background: #4caf50; margin: 5px;">Upload Logo</button>
                <input type="text" id="logo-url" placeholder="Or paste URL" style="padding: 8px; width: 300px;">
                <button type="button" onclick="handleLogoURL()" style="padding: 8px 20px; background: #2196f3; margin: 5px;">Use URL</button>
                <button type="button" onclick="removeLogo()" style="padding: 8px 20px; background: #f44336; margin: 5px;">Remove</button>
            </div>
        </div>
        
        <h1>Seay Wellness Complete M4 Assessment</h1>
        <p class="subtitle">F.I.T., MoveWell3, BACKSYS¬Æ/NECKSYS¬Æ, Vertebral Analysis & Treatment Planning</p>
        
        <div class="section">
            <h2>üìã Patient Information</h2>
            <div class="grid-3">
                <div class="input-group"><label>Patient Name:</label><input type="text" id="patientName"></div>
                <div class="input-group"><label>Age:</label><input type="number" id="patientAge"></div>
                <div class="input-group"><label>Date:</label><input type="date" id="assessmentDate"></div>
            </div>
            <div class="grid-2">
                <div class="input-group"><label>Chief Complaint:</label><textarea id="chiefComplaint" rows="3"></textarea></div>
                <div class="input-group"><label>Secondary Concerns:</label><textarea id="secondaryConcerns" rows="3"></textarea></div>
            </div>
        </div>

        <div class="section">
            <h2>üéØ F.I.T. Foundation Tests (1-5)</h2>
            <div class="fit-test-card">
                <h4>Test 1: Testability & Switching</h4>
                <div class="grid-2">
                    <div class="input-group"><label>Testability:</label><select id="testability"><option value="">Select...</option><option value="passed">Passed</option><option value="failed">Failed</option></select></div>
                    <div class="input-group"><label>Switching:</label><select id="switching"><option value="">Select...</option><option value="passed">Passed</option><option value="failed">Failed</option></select></div>
                </div>
            </div>
            <div class="fit-test-card">
                <h4>Test 2: Bilateral Scales</h4>
                <div class="grid-4">
                    <div class="input-group"><label>Right (lbs):</label><input type="number" id="scaleRight" step="0.1"></div>
                    <div class="input-group"><label>Left (lbs):</label><input type="number" id="scaleLeft" step="0.1"></div>
                    <div class="input-group"><label>Difference:</label><input type="text" id="scaleDiff" readonly style="background: #f0f0f0;"></div>
                    <div class="input-group"><label>Result:</label><select id="bilateralResult"><option value="">Select...</option><option value="passed">Passed</option><option value="failed">Failed</option></select></div>
                </div>
            </div>
            <div class="fit-test-card">
                <h4>Test 3: Standing Stress Test</h4>
                <div class="grid-2">
                    <div class="input-group"><label>Result:</label><select id="standingStress"><option value="">Select...</option><option value="passed">Passed</option><option value="failed">Failed</option></select></div>
                    <div class="input-group"><label>Belt Response:</label><select id="standingStressBelt"><option value="">Select...</option><option value="improved">Improved</option><option value="no-change">No Change</option></select></div>
                </div>
            </div>
            <div class="fit-test-card">
                <h4>Test 4: Brain-Cortex</h4>
                <div class="input-group"><label>Result:</label><select id="brainCortexResult"><option value="">Select...</option><option value="passed">Passed</option><option value="failed">Failed</option></select></div>
            </div>
            <div class="fit-test-card">
                <h4>Test 5: Cerebellum</h4>
                <div class="grid-2">
                    <div class="input-group"><label>Sway:</label><select id="cerebellarSway"><option value="">Select...</option><option value="none">No Sway</option><option value="right">Right</option><option value="left">Left</option></select></div>
                    <div class="input-group"><label>Result:</label><select id="cerebellarResult"><option value="">Select...</option><option value="passed">Passed</option><option value="failed">Failed</option></select></div>
                </div>
            </div>
        </div>

        <div class="section">
            <h2>üí™ F.I.T. Capacity Tests (6-16)</h2>
            <div class="fit-test-card">
                <h4>Test 6: JAMAR Grip</h4>
                <div class="grid-3">
                    <div class="input-group"><label>Right (lbs):</label><input type="number" id="jamarRight" step="0.1"></div>
                    <div class="input-group"><label>Left (lbs):</label><input type="number" id="jamarLeft" step="0.1"></div>
                    <div class="input-group"><label>Difference:</label><input type="text" id="jamarDiff" readonly style="background: #f0f0f0;"></div>
                </div>
            </div>
            <div class="fit-test-card">
                <h4>Test 11: SlackBlock</h4>
                <div class="grid-3">
                    <div class="input-group"><label>Right (sec):</label><input type="number" id="slackBlockRight"></div>
                    <div class="input-group"><label>Left (sec):</label><input type="number" id="slackBlockLeft"></div>
                    <div class="input-group"><label>Result:</label><select id="slackBlockResult"><option value="">Select...</option><option value="passed">Passed (30+ sec)</option><option value="failed">Failed</option></select></div>
                </div>
            </div>
        </div>

        <div class="section">
            <h2>üèÉ MoveWell3 Screening</h2>
            <div class="fit-test-card">
                <h4>Deep Squat</h4>
                <div class="grid-2">
                    <div class="input-group"><label>Result:</label><select id="deepSquat"><option value="">Select...</option><option value="functional">Functional</option><option value="dysfunctional">Dysfunctional</option><option value="painful">Painful</option></select></div>
                    <div class="input-group"><label>Pain (0-10):</label><input type="number" id="deepSquatPain" min="0" max="10" value="0"></div>
                </div>
            </div>
            <div class="fit-test-card">
                <h4>Cervical ROM</h4>
                <div class="grid-3">
                    <div class="input-group"><label>Flexion:</label><select id="cervicalFlexion"><option value="">Select...</option><option value="functional">Functional</option><option value="limited">Limited</option><option value="painful">Painful</option></select></div>
                    <div class="input-group"><label>Extension:</label><select id="cervicalExtension"><option value="">Select...</option><option value="functional">Functional</option><option value="limited">Limited</option><option value="painful">Painful</option></select></div>
                    <div class="input-group"><label>Rotation:</label><select id="cervicalRotation"><option value="">Select...</option><option value="functional">Functional</option><option value="limited">Limited</option><option value="painful">Painful</option></select></div>
                </div>
            </div>
        </div>

        <div class="section">
            <h2>üìê Postural Deviations (BACKSYS¬Æ/NECKSYS¬Æ)</h2>
            <p>Click to select deviations:</p>
            <button class="deviation-btn" onclick="selectDeviation(this)" data-name="Right Lateral Translation (Thoracic)">Right Lateral Translation (Thoracic)</button>
            <button class="deviation-btn" onclick="selectDeviation(this)" data-name="Left Lateral Translation (Thoracic)">Left Lateral Translation (Thoracic)</button>
            <button class="deviation-btn" onclick="selectDeviation(this)" data-name="Left Translation (Cervical)">Left Translation (Cervical)</button>
            <button class="deviation-btn" onclick="selectDeviation(this)" data-name="Right Translation (Cervical)">Right Translation (Cervical)</button>
        </div>

        <div class="section">
            <h2>üéØ Vertebral Subluxation Analysis</h2>
            <p>Click vertebrae to select (click again to deselect):</p>
            <div id="selected-verts-summary" style="display: none; background: #ffebee; padding: 15px; border-radius: 5px; margin: 15px 0;">
                <h4 style="color: #c62828;">‚úì Selected: <span id="vert-count">0</span></h4>
                <div id="selected-verts-list" style="display: flex; flex-wrap: wrap; gap: 8px;"></div>
                <button type="button" onclick="clearAllVerts()" style="padding: 8px 15px; font-size: 14px; background: #f44336; margin-top: 10px;">Clear All</button>
            </div>
            <div class="spine-container">
                <div class="spine-grid">
                    <div class="spine-section-label">CERVICAL</div>
                    <div class="vertebra" onclick="selectVert('C1')">C1</div>
                    <div class="vertebra" onclick="selectVert('C2')">C2</div>
                    <div class="vertebra" onclick="selectVert('C3')">C3</div>
                    <div class="vertebra" onclick="selectVert('C4')">C4</div>
                    <div class="vertebra" onclick="selectVert('C5')">C5</div>
                    <div class="vertebra" onclick="selectVert('C6')">C6</div>
                    <div class="vertebra" onclick="selectVert('C7')">C7</div>
                    <div class="spine-section-label">THORACIC</div>
                    <div class="vertebra" onclick="selectVert('T1')">T1</div>
                    <div class="vertebra" onclick="selectVert('T2')">T2</div>
                    <div class="vertebra" onclick="selectVert('T3')">T3</div>
                    <div class="vertebra" onclick="selectVert('T4')">T4</div>
                    <div class="vertebra" onclick="selectVert('T5')">T5</div>
                    <div class="vertebra" onclick="selectVert('T6')">T6</div>
                    <div class="vertebra" onclick="selectVert('T7')">T7</div>
                    <div class="vertebra" onclick="selectVert('T8')">T8</div>
                    <div class="vertebra" onclick="selectVert('T9')">T9</div>
                    <div class="vertebra" onclick="selectVert('T10')">T10</div>
                    <div class="vertebra" onclick="selectVert('T11')">T11</div>
                    <div class="vertebra" onclick="selectVert('T12')">T12</div>
                    <div class="spine-section-label">LUMBAR</div>
                    <div class="vertebra" onclick="selectVert('L1')">L1</div>
                    <div class="vertebra" onclick="selectVert('L2')">L2</div>
                    <div class="vertebra" onclick="selectVert('L3')">L3</div>
                    <div class="vertebra" onclick="selectVert('L4')">L4</div>
                    <div class="vertebra" onclick="selectVert('L5')">L5</div>
                    <div class="spine-section-label">SACRAL</div>
                    <div class="vertebra" onclick="selectVert('Sacrum')">Sacrum</div>
                </div>
            </div>
        </div>

        <div class="section">
            <h2>üè• Treatment Services</h2>
            <div class="service-selector">
                <div class="service-item"><label><input type="checkbox" id="serviceAdjustment"><strong>Adjustment</strong></label><p>$75</p></div>
                <div class="service-item"><label><input type="checkbox" id="serviceART"><strong>ART</strong></label><p>$65</p></div>
                <div class="service-item"><label><input type="checkbox" id="serviceDryNeedling"><strong>Dry Needling</strong></label><p>$55</p></div>
                <div class="service-item"><label><input type="checkbox" id="serviceRehab"><strong>Rehab</strong></label><p>$80</p></div>
                <div class="service-item"><label><input type="checkbox" id="serviceLaser"><strong>Laser</strong></label><p>$75</p></div>
            </div>
        </div>

        <div class="section">
            <h2>üíº Membership Plans</h2>
            <div class="plan-selector">
                <div class="plan-option" onclick="selectPlan(this)" data-plan="core-support"><strong>Core Support - $128/mo</strong><br>2 Adjustments/month</div>
                <div class="plan-option" onclick="selectPlan(this)" data-plan="essential-care"><strong>Essential Care - $240/mo</strong><br>4 Adjustments/month</div>
                <div class="plan-option" onclick="selectPlan(this)" data-plan="complete-care"><strong>Complete Care - $595/mo</strong><br>4 Adj + 4 Rehab + 4 Laser + 4 ART</div>
                <input type="hidden" id="selectedPlan">
            </div>
        </div>

        <div class="section">
            <h2>üíä Supplement Protocols</h2>
            <div class="supplement-card">
                <label><input type="checkbox" id="suppJointSupport"><h4 style="display: inline;">Joint Support</h4></label>
                <p>Glucosamine/Chondroitin, Collagen, Inflamma LF</p>
            </div>
            <div class="supplement-card">
                <label><input type="checkbox" id="suppAntiInflammatory"><h4 style="display: inline;">Anti-Inflammatory</h4></label>
                <p>Bio-A Curcumin, Bio-Omega 3, Inflamma LF</p>
            </div>
            <div class="supplement-card">
                <label><input type="checkbox" id="suppNerveSupport"><h4 style="display: inline;">Nerve Support</h4></label>
                <p>Methyl-B12, BioHealth Matrix, NAC Forte</p>
            </div>
        </div>

        <div class="section">
            <h2>üî¨ Lab Testing</h2>
            <div class="lab-card">
                <label><input type="checkbox" id="labCMP"><h4 style="display: inline;">Comprehensive Metabolic Panel</h4></label>
            </div>
            <div class="lab-card">
                <label><input type="checkbox" id="labThyroid"><h4 style="display: inline;">Thyroid Panel</h4></label>
            </div>
            <div class="lab-card">
                <label><input type="checkbox" id="labVitD"><h4 style="display: inline;">Vitamin D</h4></label>
            </div>
        </div>

        <button onclick="generateReport()">Generate Complete Assessment & Report</button>

        <div id="actionButtons" class="action-buttons" style="display: none;">
            <button class="print-button" onclick="printReport()">üñ®Ô∏è Print Report</button>
            <button class="pdf-button" onclick="downloadPDF()">üìÑ Download PDF</button>
        </div>

        <div id="reportOutput" class="report-output"></div>
    </div>

    <script>
        const vertCorrelations = {
            'C1': { organs: 'Brain, Pituitary, Scalp', symptoms: 'Headaches, migraines, insomnia' },
            'C2': { organs: 'Eyes, Sinuses, Forehead', symptoms: 'Sinus troubles, allergies' },
            'C3': { organs: 'Face, Teeth', symptoms: 'Neuralgia, acne' },
            'C4': { organs: 'Nose, Lips, Mouth', symptoms: 'Hay fever' },
            'C5': { organs: 'Vocal Cords, Pharynx', symptoms: 'Laryngitis, hoarseness' },
            'C6': { organs: 'Neck Muscles, Shoulders', symptoms: 'Stiff neck' },
            'C7': { organs: 'Thyroid, Shoulders', symptoms: 'Thyroid conditions' },
            'T1': { organs: 'Arms, Esophagus', symptoms: 'Asthma, cough' },
            'T2': { organs: 'Heart', symptoms: 'Chest pain' },
            'T3': { organs: 'Lungs, Chest', symptoms: 'Bronchitis, pneumonia' },
            'T4': { organs: 'Gallbladder', symptoms: 'Gallbladder issues' },
            'T5': { organs: 'Liver, Blood', symptoms: 'Liver conditions, anemia' },
            'T6': { organs: 'Stomach', symptoms: 'Indigestion, heartburn' },
            'T7': { organs: 'Pancreas', symptoms: 'Diabetes, ulcers' },
            'T8': { organs: 'Spleen', symptoms: 'Lowered immunity' },
            'T9': { organs: 'Adrenals', symptoms: 'Allergies, fatigue' },
            'T10': { organs: 'Kidneys', symptoms: 'Kidney troubles' },
            'T11': { organs: 'Kidneys, Ureters', symptoms: 'Skin conditions' },
            'T12': { organs: 'Small Intestines', symptoms: 'Rheumatism, gas' },
            'L1': { organs: 'Large Intestines', symptoms: 'Constipation, colitis' },
            'L2': { organs: 'Appendix, Abdomen', symptoms: 'Appendicitis, cramps' },
            'L3': { organs: 'Sex Organs, Bladder', symptoms: 'Bladder issues, knee pain' },
            'L4': { organs: 'Prostate, Sciatic', symptoms: 'Sciatica, back pain' },
            'L5': { organs: 'Lower Legs, Ankles', symptoms: 'Poor circulation, swollen ankles' },
            'Sacrum': { organs: 'Hip Bones, SI Joint', symptoms: 'SI conditions, pelvic imbalance' }
        };

        let selectedVerts = [];
        let selectedDeviations = [];
        let logoDataURL = null;

        document.getElementById('assessmentDate').valueAsDate = new Date();

        document.getElementById('logo-upload').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    logoDataURL = e.target.result;
                    displayLogo(logoDataURL);
                };
                reader.readAsDataURL(file);
            }
        });

        function handleLogoURL() {
            const url = document.getElementById('logo-url').value.trim();
            if (url) {
                logoDataURL = url;
                displayLogo(url);
            }
        }

        function displayLogo(src) {
            const img = document.createElement('img');
            img.src = src;
            img.style.maxWidth = '400px';
            img.style.maxHeight = '120px';
            img.onload = function() {
                document.getElementById('logo-display').innerHTML = '';
                document.getElementById('logo-display').appendChild(img);
            };
        }

        function removeLogo() {
            logoDataURL = null;
            document.getElementById('logo-display').innerHTML = '';
            document.getElementById('logo-url').value = '';
        }

        document.getElementById('scaleRight').addEventListener('input', calculateScaleDiff);
        document.getElementById('scaleLeft').addEventListener('input', calculateScaleDiff);

        function calculateScaleDiff() {
            const right = parseFloat(document.getElementById('scaleRight').value) || 0;
            const left = parseFloat(document.getElementById('scaleLeft').value) || 0;
            const diff = Math.abs(right - left);
            document.getElementById('scaleDiff').value = `${diff.toFixed(1)} lbs`;
        }

        document.getElementById('jamarRight').addEventListener('input', calculateJamarDiff);
        document.getElementById('jamarLeft').addEventListener('input', calculateJamarDiff);

        function calculateJamarDiff() {
            const right = parseFloat(document.getElementById('jamarRight').value) || 0;
            const left = parseFloat(document.getElementById('jamarLeft').value) || 0;
            const diff = Math.abs(right - left);
            document.getElementById('jamarDiff').value = `${diff.toFixed(1)} lbs`;
        }

        function selectDeviation(btn) {
            btn.classList.toggle('selected');
            const name = btn.dataset.name;
            if (btn.classList.contains('selected')) {
                selectedDeviations.push({ name: name });
            } else {
                selectedDeviations = selectedDeviations.filter(d => d.name !== name);
            }
        }

        function selectVert(vertId) {
            const element = document.querySelector(`.vertebra:nth-child(${getVertIndex(vertId)})`);
            if (!element) return;
            
            element.classList.toggle('selected');
            if (element.classList.contains('selected')) {
                if (!selectedVerts.includes(vertId)) selectedVerts.push(vertId);
            } else {
                selectedVerts = selectedVerts.filter(v => v !== vertId);
            }
            updateVertSummary();
        }

        function getVertIndex(vertId) {
            const verts = ['C1','C2','C3','C4','C5','C6','C7','T1','T2','T3','T4','T5','T6','T7','T8','T9','T10','T11','T12','L1','L2','L3','L4','L5','Sacrum'];
            return verts.indexOf(vertId) + 2;
        }

        function updateVertSummary() {
            const summary = document.getElementById('selected-verts-summary');
            const count = document.getElementById('vert-count');
            const list = document.getElementById('selected-verts-list');
            
            if (selectedVerts.length === 0) {
                summary.style.display = 'none';
                return;
            }
            
            summary.style.display = 'block';
            count.textContent = selectedVerts.length;
            list.innerHTML = selectedVerts.map(v => `<span style="background: #ef5350; color: white; padding: 8px 12px; border-radius: 20px; font-weight: bold;">${v}</span>`).join('');
        }

        function clearAllVerts() {
            document.querySelectorAll('.vertebra.selected').forEach(el => el.classList.remove('selected'));
            selectedVerts = [];
            updateVertSummary();
        }

        function selectPlan(option) {
            document.querySelectorAll('.plan-option').forEach(opt => opt.classList.remove('selected'));
            option.classList.add('selected');
            document.getElementById('selectedPlan').value = option.dataset.plan;
        }

        function printReport() {
            window.print();
        }

        function downloadPDF() {
            const element = document.getElementById('reportOutput');
            const patientName = document.getElementById('patientName').value || 'Patient';
            const date = document.getElementById('assessmentDate').value || new Date().toISOString().split('T')[0];
            
            html2pdf().set({
                margin: 0.5,
                filename: `${patientName}_M4_Assessment_${date}.pdf`,
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { scale: 2 },
                jsPDF: { unit: 'in', format: 'letter', orientation: 'portrait' }
            }).from(element).save();
        }

        function generateReport() {
            const patientName = document.getElementById('patientName').value || 'Patient';
            const patientAge = document.getElementById('patientAge').value || 'N/A';
            const assessmentDate = document.getElementById('assessmentDate').value || new Date().toLocaleDateString();
            const chiefComplaint = document.getElementById('chiefComplaint').value || 'Not specified';

            let severityScore = 0;
            let findings = [];

            if (document.getElementById('testability').value === 'failed') {
                severityScore += 2;
                findings.push('Testability failure - neurological disruption');
            }
            if (document.getElementById('switching').value === 'failed') {
                severityScore += 2;
                findings.push('Switching failure - nervous system dysfunction');
            }

            const scaleRight = parseFloat(document.getElementById('scaleRight').value) || 0;
            const scaleLeft = parseFloat(document.getElementById('scaleLeft').value) || 0;
            const scaleDiff = Math.abs(scaleRight - scaleLeft);
            if (scaleDiff > 10) {
                severityScore += 3;
                findings.push(`Weight asymmetry: ${scaleDiff.toFixed(1)} lbs difference`);
            }

            if (document.getElementById('standingStress').value === 'failed') {
                severityScore += 3;
                findings.push('SI ligament dysfunction detected');
            }

            if (document.getElementById('brainCortexResult').value === 'failed') {
                severityScore += 2;
                findings.push('Brain-cortex weakness - motor control deficits');
            }

            const swayValue = document.getElementById('cerebellarSway').value;
            if (swayValue !== 'none' && swayValue !== '') {
                severityScore += 3;
                findings.push('Cerebellar imbalance - fall risk');
            }

            const jamarRight = parseFloat(document.getElementById('jamarRight').value) || 0;
            const jamarLeft = parseFloat(document.getElementById('jamarLeft').value) || 0;
            const avgGrip = (jamarRight + jamarLeft) / 2;
            if (avgGrip > 0 && avgGrip < 60) {
                severityScore += 3;
                findings.push(`CRITICAL: Low grip strength (${avgGrip.toFixed(1)} lbs) - mortality risk`);
            }

            const slackBlockRight = parseFloat(document.getElementById('slackBlockRight').value) || 0;
            const slackBlockLeft = parseFloat(document.getElementById('slackBlockLeft').value) || 0;
            if (slackBlockRight < 30 || slackBlockLeft < 30) {
                if (slackBlockRight > 0 || slackBlockLeft > 0) {
                    severityScore += 2;
                    findings.push(`Poor dynamic balance: R=${slackBlockRight}s, L=${slackBlockLeft}s`);
                }
            }

            if (document.getElementById('deepSquat').value === 'dysfunctional' || document.getElementById('deepSquat').value === 'painful') {
                severityScore += 2;
                findings.push('Dysfunctional squat pattern');
            }

            if (document.getElementById('cervicalFlexion').value === 'limited' || document.getElementById('cervicalFlexion').value === 'painful') {
                severityScore += 2;
                findings.push('Restricted cervical ROM');
            }

            if (selectedDeviations.length > 0) {
                severityScore += selectedDeviations.length;
                findings.push(`${selectedDeviations.length} postural deviation(s) identified`);
            }

            if (selectedVerts.length > 0) {
                severityScore += selectedVerts.length * 0.5;
                findings.push(`${selectedVerts.length} vertebral subluxation(s) detected`);
            }

            let severityLevel, severityClass, recommendedFrequency, recommendedDuration;
            if (severityScore <= 5) {
                severityLevel = 'MILD';
                severityClass = 'severity-mild';
                recommendedFrequency = '2 times per week';
                recommendedDuration = '4-6 weeks';
            } else if (severityScore <= 12) {
                severityLevel = 'MODERATE';
                severityClass = 'severity-moderate';
                recommendedFrequency = '3 times per week';
                recommendedDuration = '6-8 weeks';
            } else {
                severityLevel = 'SEVERE';
                severityClass = 'severity-severe';
                recommendedFrequency = '4-5 times per week';
                recommendedDuration = '8-12 weeks';
            }

            let selectedServices = [];
            if (document.getElementById('serviceAdjustment').checked) selectedServices.push('Chiropractic Adjustments');
            if (document.getElementById('serviceART').checked) selectedServices.push('Active Release Technique');
            if (document.getElementById('serviceDryNeedling').checked) selectedServices.push('Dry Needling');
            if (document.getElementById('serviceRehab').checked) selectedServices.push('Functional Rehabilitation');
            if (document.getElementById('serviceLaser').checked) selectedServices.push('Laser Therapy');

            let supplements = [];
            if (document.getElementById('suppJointSupport').checked) {
                supplements.push({ name: 'Joint Support Protocol', products: ['Glucosamine/Chondroitin', 'Collagen Complex', 'Inflamma LF'] });
            }
            if (document.getElementById('suppAntiInflammatory').checked) {
                supplements.push({ name: 'Anti-Inflammatory Protocol', products: ['Bio-A Curcumin', 'Bio-Omega 3', 'Inflamma LF'] });
            }
            if (document.getElementById('suppNerveSupport').checked) {
                supplements.push({ name: 'Nerve Support Protocol', products: ['Methyl-B12 Spray', 'BioHealth Matrix', 'NAC Forte'] });
            }

            let labs = [];
            if (document.getElementById('labCMP').checked) labs.push('Comprehensive Metabolic Panel');
            if (document.getElementById('labThyroid').checked) labs.push('Complete Thyroid Panel');
            if (document.getElementById('labVitD').checked) labs.push('Vitamin D (25-OH)');

            const selectedPlan = document.getElementById('selectedPlan').value;
            let planName = 'No plan selected';
            const planMap = {
                'core-support': 'Core Support Plan - $128/month (2 Adjustments)',
                'essential-care': 'Essential Care Plan - $240/month (4 Adjustments)',
                'complete-care': 'Complete Care Plan - $595/month (Full M4 Program)'
            };
            if (selectedPlan && planMap[selectedPlan]) {
                planName = planMap[selectedPlan];
            }

            let deviationsSection = '';
            if (selectedDeviations.length > 0) {
                deviationsSection = '<h3>Postural Deviations (BACKSYS¬Æ/NECKSYS¬Æ)</h3><ul style="margin-left: 20px;">';
                selectedDeviations.forEach(dev => {
                    deviationsSection += `<li>${dev.name}</li>`;
                });
                deviationsSection += '</ul>';
            }

            let vertebralAnalysis = '';
            if (selectedVerts.length > 0) {
                vertebralAnalysis = '<h3>Vertebral Subluxation Analysis</h3>';
                vertebralAnalysis += `<p><strong>Selected Vertebrae:</strong> ${selectedVerts.join(', ')}</p><div style="margin-left: 20px;">`;
                selectedVerts.forEach(vert => {
                    const data = vertCorrelations[vert];
                    if (data) {
                        vertebralAnalysis += `<div style="margin: 10px 0; padding: 10px; background: #f0f7ff; border-left: 4px solid #667eea; border-radius: 5px;">
                            <p><strong>${vert}:</strong></p>
                            <p><em>Organs:</em> ${data.organs}</p>
                            <p><em>Symptoms:</em> ${data.symptoms}</p>
                        </div>`;
                    }
                });
                vertebralAnalysis += '</div>';
            }

            const reportHTML = `
                ${logoDataURL ? `<div style="text-align: center; margin-bottom: 20px;"><img src="${logoDataURL}" style="max-width: 400px; max-height: 120px;"></div>` : ''}
                <h2 style="text-align: center; color: #667eea;">COMPREHENSIVE M4 ASSESSMENT & REPORT</h2>
                
                <div style="background: #f9f9f9; padding: 20px; border-radius: 10px; margin: 20px 0;">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                        <div>
                            <p><strong>Patient:</strong> ${patientName}</p>
                            <p><strong>Age:</strong> ${patientAge}</p>
                            <p><strong>Date:</strong> ${assessmentDate}</p>
                        </div>
                        <div>
                            <p><strong>Severity:</strong> <span class="severity-badge ${severityClass}">${severityLevel}</span></p>
                        </div>
                    </div>
                    <p style="margin-top: 15px;"><strong>Chief Complaint:</strong> ${chiefComplaint}</p>
                </div>

                <h3>Clinical Findings</h3>
                <div style="background: #fff3e0; border-left: 4px solid #ff9800; padding: 15px; border-radius: 5px;">
                    ${findings.length > 0 ? `<ul style="margin: 10px 0 10px 20px;">${findings.map(f => `<li>${f}</li>`).join('')}</ul>` : '<p>Assessment complete - all tests within functional ranges.</p>'}
                </div>

                ${deviationsSection}
                ${vertebralAnalysis}

                <h3>PERSONALIZED TREATMENT PLAN</h3>
                <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 25px; border-radius: 10px; margin: 20px 0;">
                    <h4 style="color: white;">Visit Schedule</h4>
                    <p><strong>Frequency:</strong> ${recommendedFrequency}</p>
                    <p><strong>Duration:</strong> ${recommendedDuration}</p>
                </div>

                <h4>Recommended Services:</h4>
                ${selectedServices.length > 0 ? `<ul style="margin: 15px 0 15px 20px;">${selectedServices.map(s => `<li><strong>${s}</strong></li>`).join('')}</ul>` : '<p>No services selected</p>'}

                <h4>Recommended Plan:</h4>
                <div style="background: #e8f5e9; padding: 15px; border-radius: 5px; margin: 10px 0;">
                    <p style="font-size: 1.2em;">${planName}</p>
                </div>

                ${supplements.length > 0 ? `
                    <h3>Supplement Protocol</h3>
                    ${supplements.map(protocol => `
                        <div style="background: #e8f5e9; padding: 15px; margin: 10px 0; border-radius: 8px; border-left: 4px solid #4caf50;">
                            <h4 style="color: #4caf50;">${protocol.name}</h4>
                            <ul style="margin: 10px 0 10px 20px;">${protocol.products.map(p => `<li>${p}</li>`).join('')}</ul>
                        </div>
                    `).join('')}
                ` : ''}

                ${labs.length > 0 ? `
                    <h3>Recommended Laboratory Testing</h3>
                    <ul style="margin: 10px 0 10px 20px;">${labs.map(lab => `<li>${lab}</li>`).join('')}</ul>
                ` : ''}

                <h3 style="color: #d32f2f;">‚ö†Ô∏è LONG-TERM HEALTH CONSEQUENCES (If Untreated)</h3>
                <div style="background: #ffebee; border-left: 4px solid #d32f2f; padding: 20px; border-radius: 5px;">
                    <ul style="margin: 10px 0 10px 20px;">
                        <li><strong>Progressive spinal degeneration</strong></li>
                        <li><strong>Chronic pain and decreased quality of life</strong></li>
                        <li><strong>Increased injury risk</strong></li>
                        ${avgGrip > 0 && avgGrip < 60 ? '<li><strong>CRITICAL: Increased mortality risk</strong></li>' : ''}
                        ${scaleDiff > 10 ? '<li><strong>Accelerated joint degeneration</strong></li>' : ''}
                        ${swayValue !== 'none' && swayValue !== '' ? '<li><strong>CRITICAL: Fall risk with life-altering injuries</strong></li>' : ''}
                        <li><strong>Neurological decline</strong></li>
                    </ul>
                    <p style="margin-top: 15px; font-weight: bold;">These problems are FAR EASIER to correct NOW. The time to act is TODAY.</p>
                </div>

                <h3>Your Next Steps</h3>
                <div style="background: #e3f2fd; padding: 20px; border-radius: 5px;">
                    <ol style="margin: 10px 0 10px 20px; line-height: 2;">
                        <li><strong>Begin Care Immediately</strong></li>
                        <li><strong>Commit to ${recommendedFrequency}</strong></li>
                        ${selectedDeviations.length > 0 ? '<li><strong>Perform Home Exercises</strong></li>' : ''}
                        ${supplements.length > 0 ? '<li><strong>Follow Supplement Protocol</strong></li>' : ''}
                        ${labs.length > 0 ? '<li><strong>Complete Lab Testing</strong></li>' : ''}
                        <li><strong>Enroll in ${planName}</strong></li>
                    </ol>
                </div>

                <div style="text-align: center; margin-top: 30px; padding: 30px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-radius: 10px;">
                    <h3 style="color: white;">You Have a Clear Path Forward</h3>
                    <p style="font-size: 1.2em; margin: 15px 0;">Let's discuss your questions and get you started TODAY!</p>
                </div>

                <div style="margin-top: 30px; padding: 20px; border-top: 2px solid #667eea; text-align: center;">
                    <p><strong>Seay Wellness</strong><br>Garner, NC | (919) 662-0520<br>www.seaywellness.com</p>
                </div>
            `;

            document.getElementById('reportOutput').innerHTML = reportHTML;
            document.getElementById('reportOutput').style.display = 'block';
            document.getElementById('actionButtons').style.display = 'flex';
            document.getElementById('reportOutput').scrollIntoView({ behavior: 'smooth' });
        }
    </script>
</body>
</html>
